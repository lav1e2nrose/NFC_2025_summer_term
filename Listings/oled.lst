C51 COMPILER V9.60.7.0   OLED                                                              08/29/2025 17:38:18 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE OLED
OBJECT MODULE PLACED IN .\Objects\oled.obj
COMPILER INVOKED BY: E:\Keil\C51\BIN\C51.EXE oled.c COMPACT OPTIMIZE(8,SPEED) BROWSE INCDIR(C:\Program Files\Keil_v5\C51
                    -\INC) DEBUG OBJECTEXTEND PRINT(.\Listings\oled.lst) TABS(2) OBJECT(.\Objects\oled.obj)

line level    source

   1          #include "oled.h"
   2          #include "oledfont.h"
   3          
   4          // OLED 的显存
   5          // 存放格式如下
   6          // [0] 0 1 2 3 ... 127
   7          // [1] 0 1 2 3 ... 127
   8          // [2] 0 1 2 3 ... 127
   9          // [3] 0 1 2 3 ... 127
  10          // [4] 0 1 2 3 ... 127
  11          // [5] 0 1 2 3 ... 127
  12          // [6] 0 1 2 3 ... 127
  13          // [7] 0 1 2 3 ... 127
  14          
  15          #if OLED_MODE == 1
              // 向 SSD1106 写入一个字节。
              // dat: 要写入的数据 / 命令
              // cmd: 数据 / 命令标志 0, 表示命令; 1, 表示数据;
              void OLED_WR_Byte(u8 dat, u8 cmd)
              {
                DATAOUT(dat);     
                if (cmd)
                {
                  OLED_DC_Set();
                }
                else
                {
                  OLED_DC_Clr();
                }
                OLED_WR_Clr();
                OLED_WR_Set();
                OLED_DC_Set();
              }
              #else
  35          // 向 SSD1306 写入一个字节。
  36          // dat: 要写入的数据 / 命令
  37          // cmd: 数据 / 命令标志 0, 表示命令; 1, 表示数据;
  38          void OLED_WR_Byte(u8 dat, u8 cmd)
  39          { 
  40   1        u8 i;
  41   1        if (cmd)
  42   1        {
  43   2          OLED_DC_Set();
  44   2        }
  45   1        else
  46   1        {
  47   2          OLED_DC_Clr();
  48   2        }     
  49   1        for (i = 0; i < 8; i++)
  50   1        {       
  51   2          OLED_SCLK_Clr();
  52   2          if (dat & 0x80)
  53   2          {
  54   3              OLED_SDIN_Set();
C51 COMPILER V9.60.7.0   OLED                                                              08/29/2025 17:38:18 PAGE 2   

  55   3          }
  56   2          else
  57   2          {
  58   3            OLED_SDIN_Clr();
  59   3          }
  60   2          OLED_SCLK_Set();
  61   2          dat <<= 1;   
  62   2        }             
  63   1        OLED_DC_Set();      
  64   1      } 
  65          #endif
  66          void OLED_Set_Pos(u8 x, u8 y) 
  67          { 
  68   1        OLED_WR_Byte(0xb0 + y, OLED_CMD);
  69   1        OLED_WR_Byte(((x & 0xf0) >> 4) | 0x10, OLED_CMD);
  70   1        OLED_WR_Byte((x & 0x0f) | 0x01, OLED_CMD); 
  71   1      }       
  72          // 开启 OLED 显示    
  73          // void OLED_Display_On(void)
  74          // {
  75          //  OLED_WR_Byte(0X8D, OLED_CMD);  // SET DCDC 命令
  76          //  OLED_WR_Byte(0X14, OLED_CMD);  // DCDC ON
  77          //  OLED_WR_Byte(0XAF, OLED_CMD);  // DISPLAY ON
  78          // }
  79          // 关闭 OLED 显示     
  80          // void OLED_Display_Off(void)
  81          // {
  82          //  OLED_WR_Byte(0X8D, OLED_CMD);  // SET DCDC 命令
  83          //  OLED_WR_Byte(0X10, OLED_CMD);  // DCDC OFF
  84          //  OLED_WR_Byte(0XAE, OLED_CMD);  // DISPLAY OFF
  85          // }             
  86          // 清屏函数，清完屏，整个屏幕是黑色的！和没点亮一样！    
  87          void OLED_Clear(void)
  88          {
  89   1        u8 i, n;
  90   1        for(i = 0; i < 8; i++)  
  91   1        {  
  92   2          OLED_WR_Byte(0xb0 + i, OLED_CMD);  // 设置页地址（0 ~ 7）
  93   2          OLED_WR_Byte(0x00, OLED_CMD);      // 设置显示位置 — 列低地址
  94   2          OLED_WR_Byte(0x10, OLED_CMD);      // 设置显示位置 — 列高地址   
  95   2          for (n = 0; n < 128; n++) OLED_WR_Byte(0, OLED_DATA); 
  96   2        } // 更新显示
  97   1      }
  98          
  99          // 在指定位置显示一个字符,包括部分字符
 100          // x: 0 ~ 127
 101          // y: 0 ~ 63
 102          // mode: 0, 反白显示; 1, 正常显示        
 103          // size: 选择字体 16 / 12 
 104          void OLED_ShowChar(u8 x, u8 y, u8 chr)
 105          {       
 106   1        u8 c = chr - ' ', i = 0; // 得到偏移后的值   
 107   1        if (x > Max_Column - 1)
 108   1        {
 109   2          x = 0;
 110   2          y = y + 2;
 111   2        }
 112   1        if (SIZE == 16)
 113   1        {
 114   2          OLED_Set_Pos(x, y); 
 115   2          for(i = 0; i < 8; i++)
 116   2          OLED_WR_Byte(F8X16[c * 16 + i], OLED_DATA);
C51 COMPILER V9.60.7.0   OLED                                                              08/29/2025 17:38:18 PAGE 3   

 117   2          OLED_Set_Pos(x, y + 1);
 118   2          for(i = 0; i < 8; i++)
 119   2          OLED_WR_Byte(F8X16[c * 16 + i + 8], OLED_DATA);
 120   2        }
 121   1      }
 122          
 123          // 显示一个字符号串
 124          void OLED_ShowString(u8 x, u8 y, u8 *chr)
 125          {
 126   1        u8 j = 0;
 127   1        while (chr[j] != '\0')
 128   1        {   
 129   2          OLED_ShowChar(x, y, chr[j]);
 130   2          x += 8;
 131   2          if (x > 120)
 132   2          {
 133   3            x = 0;
 134   3            y += 2;
 135   3          }
 136   2          j++;
 137   2        }
 138   1      }
 139          // 初始化 SSD1306              
 140          void OLED_Init(void)
 141          {
 142   1        OLED_RST_Set();
 143   1        delay_ms(100);
 144   1        OLED_RST_Clr();
 145   1        delay_ms(100);
 146   1        OLED_RST_Set(); 
 147   1      
 148   1        OLED_WR_Byte(0xAE, OLED_CMD); //--turn off oled panel
 149   1        OLED_WR_Byte(0x00, OLED_CMD); //---set low column address
 150   1        OLED_WR_Byte(0x10, OLED_CMD); //---set high column address
 151   1        OLED_WR_Byte(0x40, OLED_CMD); //--set start line address  Set Mapping RAM Display Start Line (0x00~0x3F)
 152   1        OLED_WR_Byte(0x81, OLED_CMD); //--set contrast control register
 153   1        OLED_WR_Byte(0xCF, OLED_CMD); // Set SEG Output Current Brightness
 154   1        OLED_WR_Byte(0xA1, OLED_CMD); //--Set SEG/Column Mapping     0xa0左右反置 0xa1正常
 155   1        OLED_WR_Byte(0xC8, OLED_CMD); //Set COM/Row Scan Direction   0xc0上下反置 0xc8正常
 156   1        OLED_WR_Byte(0xA6, OLED_CMD); //--set normal display
 157   1        OLED_WR_Byte(0xA8, OLED_CMD); //--set multiplex ratio(1 to 64)
 158   1        OLED_WR_Byte(0x3f, OLED_CMD); //--1/64 duty
 159   1        OLED_WR_Byte(0xD3, OLED_CMD); //-set display offset Shift Mapping RAM Counter (0x00~0x3F)
 160   1        OLED_WR_Byte(0x00, OLED_CMD); //-not offset
 161   1        OLED_WR_Byte(0xd5, OLED_CMD); //--set display clock divide ratio/oscillator frequency
 162   1        OLED_WR_Byte(0x80, OLED_CMD); //--set divide ratio, Set Clock as 100 Frames/Sec
 163   1        OLED_WR_Byte(0xD9, OLED_CMD); //--set pre-charge period
 164   1        OLED_WR_Byte(0xF1, OLED_CMD); //Set Pre-Charge as 15 Clocks & Discharge as 1 Clock
 165   1        OLED_WR_Byte(0xDA, OLED_CMD); //--set com pins hardware configuration
 166   1        OLED_WR_Byte(0x12, OLED_CMD);
 167   1        OLED_WR_Byte(0xDB, OLED_CMD); //--set vcomh
 168   1        OLED_WR_Byte(0x40, OLED_CMD); //Set VCOM Deselect Level
 169   1        OLED_WR_Byte(0x20, OLED_CMD); //-Set Page Addressing Mode (0x00/0x01/0x02)
 170   1        OLED_WR_Byte(0x02, OLED_CMD); //
 171   1        OLED_WR_Byte(0x8D, OLED_CMD); //--set Charge Pump enable/disable
 172   1        OLED_WR_Byte(0x14, OLED_CMD); //--set(0x10) disable
 173   1        OLED_WR_Byte(0xA4, OLED_CMD); // Disable Entire Display On (0xa4/0xa5)
 174   1        OLED_WR_Byte(0xA6, OLED_CMD); // Disable Inverse Display On (0xa6/a7) 
 175   1        OLED_WR_Byte(0xAF, OLED_CMD); //--turn on oled panel
 176   1        
 177   1        OLED_WR_Byte(0xAF, OLED_CMD); /*display ON*/ 
 178   1        OLED_Clear();
C51 COMPILER V9.60.7.0   OLED                                                              08/29/2025 17:38:18 PAGE 4   

 179   1        OLED_Set_Pos(0, 0);
 180   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    470    ----
   CONSTANT SIZE    =   1536    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----       6
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
